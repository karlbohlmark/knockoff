<meta charset="utf-8">

<div id="root">
    <div data-bind="foreach: user in users">
        <span data-bind="text: user.firstname, attr: { id: user.firstname}, style: user.style, click: user.hello"></span>
        <input data-bind="value: user.firstname">
        <ul class="roles">
            <li class="role" data-bind="foreach: role in user.roles, click: user.intro.bind(user, role)">
                <span data-bind="text: role"></span>
            </li>
        </ul>
        <ul class="groups">
            <li class="group" data-bind="foreach: group in user.groups(), text: group"></li>
        </ul>
    </div>
</div>

<script src="build/build.js"></script>
<script>
    $ = require('dom')
    var model = require('karlbohlmark-evented-model/index.js')
    
    var ObservableCollection = require('karlbohlmark-observable-collection/index.js')

    var User = model('User')
                .attr('firstname')
                .attr('roles', [{type: 'string'}])
                .attr('style', {type: 'object', 'default': {
                    'background-color': 'red'
                }})


    User.prototype.hello = function () {
        console.log('hello, my name is ' + this.firstname)
    }

    User.prototype.intro = function (role) {
        this.hello()
        console.log("I'm a ", role)
    }

    var lina = new User({
        firstname: 'lina',
        roles: ['admin', 'user']
    })

    var lisa = new User({
        firstname: 'lisa',
        roles: ['user']
    })

    User.prototype.groups = function () {
        return ['group1', 'group2'];   
    }

    var userList = new ObservableCollection([lina, lisa])
    
    var root = $('#root').get(0)
    var react = require("knockoff")
    react(root, { users: userList })

    lina.roles.push('another-role')

    lina.changes()(function (change) {
        console.log(change)
    })

    setTimeout(function () {
        userList.push(new User({
            firstname: 'Anna',
            roles: ['user']
        }))
    }, 500)

    lina.style['background-color'] = 'green'
    // Since the 'background-color' property is not part of the schema
    // there is no change tracking performed on it. Thus an event is manually emitted
    // to trigger rendering.
    lina.emit('change style')
</script>